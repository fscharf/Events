@model Events.Models.USUARIO
@using System.Security.Claims;

@{
    ViewBag.Title = "Editar meu cadastro";
    var userAuth = (ClaimsIdentity)User.Identity;
}

<div class="row mb-3">
    <div class="col-lg-4">
        <h4>
            <a class="text-dark mr-2" href="@Url.Action("MyProfile", "Users")"><i class="fas fa-arrow-left"></i></a>
            @ViewBag.Title
        </h4>
    </div>
</div>

<div class="row">
    <div class="col-lg-4">
        @using (Html.BeginForm(FormMethod.Post))
        {
            @Html.HiddenFor(x => x.COD_USUARIO)
            @Html.AntiForgeryToken()

            <div class="form-group">
                <label>Nome</label>
                @Html.EditorFor(model => model.NOME, new
                   {
                       htmlAttributes = new
                       {
                           @class = "form-control",
                           minlength = "3",
                           maxlength = "50",
                           required = "required",
                           pattern = @"[A-Za-zÀ-ú ']{4,}"

                       }
                   })
            </div>
            <div class="form-group">
                <label>Email</label>
                @Html.EditorFor(model => model.EMAIL, new
                   {
                       htmlAttributes = new
                       {
                           @class = "form-control",
                           type = "email",
                           minlength = "3",
                           maxlength = "35",
                           required = "required"
                       }
                   })
            </div>
            <div class="form-group">
                <label>Senha atual</label>
                @Html.EditorFor(model => model.SENHA, new
                   {
                       htmlAttributes = new
                       {
                           @class = "form-control",
                           type = "password",
                           required = "required",
                           id = "senha"
                       }
                   })
            </div>
            <div class="form-group">
                <label>Celular</label>
                @Html.EditorFor(model => model.CELULAR, new
                   {
                       htmlAttributes = new
                       {
                           @class = "form-control",
                           type = "text",
                           minlength = "11",
                           maxlength = "11",
                           required = "required",
                           pattern = "[0-9]+"
                       }
                   })
            </div>
            <div class="form-group">
                <label>Perfil</label>
                @if (userAuth.Claims.Any(c => c.Type == ClaimTypes.Role && (c.Value == "1")))
                {
                    @Html.DropDownListFor(model => model.COD_PERFIL, new List<SelectListItem>
                    {
                        new SelectListItem { Text = "Aluno", Value = "1", Selected = true },
                    }, htmlAttributes: new { @class = "custom-select", required = "required" })
                }
                else if (userAuth.Claims.Any(c => c.Type == ClaimTypes.Role && (c.Value == "2")))
                {
                    @Html.DropDownListFor(model => model.COD_PERFIL, new List<SelectListItem>
                    {
                        new SelectListItem { Text = "Visitante", Value = "2", Selected = true },
                    }, htmlAttributes: new { @class = "custom-select", required = "required" })
                }
                else if (userAuth.Claims.Any(c => c.Type == ClaimTypes.Role && (c.Value == "3" || c.Value == "4" || c.Value == "5")))
                {
                    @Html.DropDownListFor(model => model.COD_PERFIL, new List<SelectListItem>
                    {
                        new SelectListItem { Text = "Aluno", Value = "1" },
                        new SelectListItem { Text = "Visitante", Value = "2" },
                        new SelectListItem { Text = "Master", Value = "3" },
                        new SelectListItem { Text = "Administrador", Value = "4" },
                        new SelectListItem { Text = "Auxiliar de Eventos", Value = "5" },
                    }, htmlAttributes: new { @class = "custom-select", required = "required" })
                }
            </div>
            <div class="form-group">
                <button type="submit" class="btn btn-primary btn-block">Atualizar dados <i class="fas fa-check-circle mr-2"></i></button>
            </div>
        }

    </div>
</div>

@section scripts {
    <script>
        $(function () {
            var errorMsg = '@TempData["Error"]';

            if (errorMsg != '') {
                iziToast.error({
                    title: 'Erro',
                    message: errorMsg
                });
            }
        })
    </script>
}
